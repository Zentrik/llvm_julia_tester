From d5fc960b9e8f121054070e18152fc83998321f01 Mon Sep 17 00:00:00 2001
From: Zentrik <llvm.zentrik@gmail.com>
Date: Sat, 22 Mar 2025 16:37:52 +0000
Subject: [PATCH] f137c3d592e96330e450a8fd63ef7e8877fc1908

Adapt to " [TargetRegistry] Accept Triple in createTargetMachine() (NFC) #130940"
---
 src/aotcompile.cpp | 6 +++---
 src/jitlayers.cpp  | 4 ++--
 2 files changed, 5 insertions(+), 5 deletions(-)

diff --git a/src/aotcompile.cpp b/src/aotcompile.cpp
index 5ae5b2013f..602b6e740a 100644
--- a/src/aotcompile.cpp
+++ b/src/aotcompile.cpp
@@ -1531,7 +1531,7 @@ static AOTOutputs add_output_impl(Module &M, TargetMachine &SourceTM, ShardTimer
     AOTOutputs out;
     auto TM = std::unique_ptr<TargetMachine>(
         SourceTM.getTarget().createTargetMachine(
-            SourceTM.getTargetTriple().str(),
+            SourceTM.getTargetTriple(),
             SourceTM.getTargetCPU(),
             SourceTM.getTargetFeatureString(),
             SourceTM.Options,
@@ -1559,7 +1559,7 @@ static AOTOutputs add_output_impl(Module &M, TargetMachine &SourceTM, ShardTimer
 
         auto PMTM = std::unique_ptr<TargetMachine>(
             SourceTM.getTarget().createTargetMachine(
-                SourceTM.getTargetTriple().str(),
+                SourceTM.getTargetTriple(),
                 SourceTM.getTargetCPU(),
                 SourceTM.getTargetFeatureString(),
                 SourceTM.Options,
@@ -2112,7 +2112,7 @@ void jl_dump_native_impl(void *native_code,
     }
     std::unique_ptr<TargetMachine> SourceTM(
         jl_ExecutionEngine->getTarget().createTargetMachine(
-            TheTriple.getTriple(),
+            TheTriple,
             jl_ExecutionEngine->getTargetCPU(),
             jl_ExecutionEngine->getTargetFeatureString(),
             jl_ExecutionEngine->getTargetOptions(),
diff --git a/src/jitlayers.cpp b/src/jitlayers.cpp
index 7eee739f4f..938550ed82 100644
--- a/src/jitlayers.cpp
+++ b/src/jitlayers.cpp
@@ -1398,7 +1398,7 @@ namespace {
         }
         auto optlevel = CodeGenOptLevelFor(jl_options.opt_level);
         auto TM = TheTarget->createTargetMachine(
-                TheTriple.getTriple(), TheCPU, FeaturesStr,
+                TheTriple, TheCPU, FeaturesStr,
                 options,
                 relocmodel,
                 codemodel,
@@ -2366,7 +2366,7 @@ std::unique_ptr<TargetMachine> JuliaOJIT::cloneTargetMachine() const
 {
     auto NewTM = std::unique_ptr<TargetMachine>(getTarget()
         .createTargetMachine(
-            getTargetTriple().str(),
+            getTargetTriple(),
             getTargetCPU(),
             getTargetFeatureString(),
             getTargetOptions(),
-- 
2.34.1

